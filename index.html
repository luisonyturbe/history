<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Study Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .topic-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .topic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .quiz-option-btn {
            transition: background-color 0.2s, transform 0.2s;
        }
        .quiz-option-btn:hover {
            transform: scale(1.05);
        }
        .prose-custom {
            max-width: 80ch;
        }
        .prose-custom h2 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1f2937;
        }
        .prose-custom h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #374151;
        }
        .prose-custom p {
            margin-bottom: 1rem;
            line-height: 1.6;
            color: #4b5563;
        }
        .prose-custom ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
         .prose-custom li {
            margin-bottom: 0.5rem;
        }
        .modal {
            display: flex;
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app">
        <!-- This is where the pages will be rendered -->
    </div>

    <script>
        const appConfig = {
            data() {
                return {
                    currentPage: 'home',
                    currentTopic: null,
                    quizType: null,
                    questions: [],
                    currentQuestionIndex: 0,
                    score: 0,
                    userAnswers: [],
                    isLoading: false,
                    modalContent: '',
                    showModal: false,
                    connectTopic1: 'magna-carta',
                    connectTopic2: 'french-revolution',
                    connectionContent: '',
                    topics: {
                        'magna-carta': {
                            title: 'Magna Carta',
                            content: `
                                <div class="prose prose-custom" id="topic-text-magna-carta">
                                    <h2>Magna Carta</h2>
                                    <p>The Magna Carta, also known as the Great Charter, was a pivotal document in the history of democracy, lasting from 1215 and serving as the first written constitution in European history. It was written in Latin.</p>
                                    <h3>Key Events and Context:</h3>
                                    <p>King John of England faced a potential rebellion from powerful barons due to his unpopularity and actions. He had angered many with cruel treatment of prisoners, lost territories to France, and was even excommunicated by Pope Innocent III. He was compelled to agree to this charter under the threat of civil war.</p>
                                    <p>The barons, led by Robert FitzWalter, gained control of London, forcing King John to yield.</p>
                                    <p>On June 15, 1215, King John agreed to the barons' terms in a document called the Articles of the Barons. After four days of modifications, the formal document, later named the Magna Carta, was signed near the River Thames in Surrey.</p>
                                    <h3>Core Principles and Clauses:</h3>
                                    <p>The Magna Carta effectively placed the king within the rule of law, meaning he, like his people, had to obey the law. This was a significant step towards limiting the monarchy's power and shifting power to the people.</p>
                                    <p>It contained 63 clauses covering law, liberty, and the church.</p>
                                    <p>The most famous and important clause guarantees the right to justice and a fair trial for all "free men". This includes the statement: "No free man shall be seized or imprisoned, or stripped of his rights or possessions... except by the lawful judgment of his equals or by the law of the land. To no one will we sell, to no one deny or delay right or justice".</p>
                                    <p>It prohibited the levying of taxes without the "general consent of the realm," which referred to major barons and churchmen.</p>
                                    <p>It also established that laws needed to be written down and followed.</p>
                                    <h3>Legacy and Influence:</h3>
                                    <ul>
                                        <li>Although initially failing and leading to civil war, the Magna Carta was reissued after John's death by his advisors for his son, Henry III, with the 1225 version becoming definitive.</li>
                                        <li>Over time, it gained symbolic status, particularly for guaranteeing trial by jury in the 14th century and individual liberty in the 17th century.</li>
                                        <li>Its influence extended globally, impacting the 1948 Universal Declaration of Human Rights.</li>
                                        <li>In the United States, the Magna Carta served as a model for the American colonists' demands for freedom from England in 1776, inspiring the fight for independence. Its legacy is evident in the U.S. Constitution and specifically the Fifth Amendment, which protects against deprivation of life, liberty, or property without a fair trial.</li>
                                    </ul>
                                    <h3 class="mt-6">Audio Summary</h3>
                                    <audio controls class="w-full">
                                        <source src="https://docs.google.com/uc?id=1HY-5-yaoVByLweUMnwgIlzlHbumBVt5q" type="audio/mpeg">
                                        Your browser does not support the audio element.
                                    </audio>
                                </div>
                            `
                        },
                        'french-revolution': {
                            title: 'French Revolution',
                            content: `
                                <div class="prose prose-custom" id="topic-text-french-revolution">
                                    <h2>The French Revolution</h2>
                                    <p>The Directory was a significant period in The French Revolution, specifically ruling France from 1795 to 1799. This government was established after the fall of the Jacobin government and marked a shift in power to the wealthier middle class.</p>
                                    <h3>Here are the key aspects of The Directory, crucial for understanding its role:</h3>
                                    <h4>Formation and Structure:</h4>
                                    <ul>
                                        <li>It was formed following the introduction of a new constitution.</li>
                                        <li>Voting rights were denied to non-propertied sections of society, meaning only the wealthier middle class held political power.</li>
                                        <li>The government itself comprised two legislative councils.</li>
                                        <li>The day-to-day administration of the country was managed by a directory of five men.</li>
                                    </ul>
                                    <h4>Challenges and Problems Faced:</h4>
                                    <ul>
                                        <li>During its rule, The Directory encountered numerous difficulties, including famine, civil war, and ongoing wars with other countries.</li>
                                        <li>There was also a significant internal struggle for power within the directory itself and with the legislative councils.</li>
                                    </ul>
                                    <h4>Decline and Overthrow:</h4>
                                    <ul>
                                        <li>Over time, The Directory became increasingly corrupt.</li>
                                        <li>Concurrently, military leaders in France began to gain more power.</li>
                                        <li>The general populace grew unhappy with this government.</li>
                                        <li>Ultimately, in 1799, a powerful military general named Napoleon Bonaparte overthrew The Directory, bringing an end to its rule and establishing his own reign over France.</li>
                                    </ul>
                                    <p>The Directory's rule followed the period often associated with the Reign of Terror, during which the Jacobin group ran the country. The Directory's establishment aimed to stabilize France after the turbulent period that included leaders like Maximilien Robespierre.</p>
                                    <h3 class="mt-6">Audio Summary</h3>
                                    <audio controls class="w-full">
                                        <source src="https://docs.google.com/uc?id=1AkUMIefICK0b8PM7KtOrPCcWbuB326Nh" type="audio/mpeg">
                                        Your browser does not support the audio element.
                                    </audio>
                                </div>
                            `
                        },
                        'declaration-of-independence': {
                            title: 'Declaration of Independence',
                            content: `
                                <div class="prose prose-custom" id="topic-text-declaration-of-independence">
                                    <h2>Declaration of Independence</h2>
                                    <p>The "Declaration of Independence," adopted by the united States of America in Congress on July 4, 1776, served to declare the causes that compelled the thirteen colonies to separate from Great Britain. This date marks when America became independent.</p>
                                    <p>The core principles outlined in the Declaration state that all men are created equal and are endowed by their Creator with certain unalienable Rights, including Life, Liberty, and the pursuit of Happiness. To secure these rights, Governments are instituted among Men, deriving their just powers from the consent of the governed. The Declaration asserts that whenever any Form of Government becomes destructive of these ends, it is the Right of the People to alter or to abolish it and institute new Government that seems most likely to effect their Safety and Happiness. While prudence dictates against changing long-established governments for light reasons, a "long train of abuses and usurpations" evincing a design to reduce the people under "absolute Despotism" makes it their right and duty to throw off such government.</p>
                                    <p>The document details a history of repeated injuries and usurpations by the King of Great Britain, all aimed at establishing "absolute Tyranny" over the States. These grievances include:</p>
                                    <ul>
                                        <li>Refusing to assent to laws necessary for the public good.</li>
                                        <li>Forbidding governors from passing laws of immediate importance unless suspended for his assent, and then neglecting them.</li>
                                        <li>Refusing to pass laws for large districts unless people relinquished their right to representation.</li>
                                        <li>Calling legislative bodies to unusual, uncomfortable, and distant places to fatigue them into compliance.</li>
                                        <li>Dissolving Representative Houses for opposing his invasions on the rights of the people.</li>
                                        <li>Refusing to cause others to be elected after dissolving legislative bodies, leaving the States exposed.</li>
                                        <li>Obstructing the population of the States by hindering naturalization and migration, and raising conditions for land appropriations.</li>
                                        <li>Obstructing the Administration of Justice by refusing to assent to laws for establishing Judiciary Powers, and making judges dependent on his will for their tenure and salaries.</li>
                                        <li>Erecting new offices and sending officers to harass the people.</li>
                                        <li>Keeping Standing Armies among the colonies in times of peace without the consent of legislatures.</li>
                                        <li>Rendering the Military independent of and superior to the Civil Power.</li>
                                        <li>Combining with others to subject the colonists to foreign jurisdiction and pretended legislation, including quartering troops and protecting them from punishment for murder.</li>
                                        <li>Cutting off trade with all parts of the world.</li>
                                        <li>Imposing Taxes without consent.</li>
                                        <li>Depriving colonists of Trial by Jury.</li>
                                        <li>Transporting colonists beyond Seas for pretended offenses.</li>
                                        <li>Abolishing the free System of English Laws in a neighbouring Province, establishing arbitrary government, and enlarging its boundaries to introduce the same rule into the Colonies.</li>
                                        <li>Taking away charters, abolishing valuable laws, and fundamentally altering forms of government.</li>
                                        <li>Suspending legislatures and declaring power to legislate for the colonies in all cases.</li>
                                        <li>Abdicating government by declaring the colonies out of his protection and waging war.</li>
                                        <li>Plundering seas, ravaging coasts, burning towns, and destroying lives.</li>
                                        <li>Transporting foreign mercenaries to complete acts of death, desolation, and tyranny.</li>
                                        <li>Constraining captive citizens to bear arms against their country.</li>
                                        <li>Exciting domestic insurrections and bringing "merciless Indian Savages" to the frontiers.</li>
                                    </ul>
                                    <p>Despite these oppressions, the colonists repeatedly petitioned for redress, but their petitions were answered only by repeated injury. Therefore, the King's character was deemed that of a tyrant, unfit to rule a free people. The colonists also warned their British brethren about unwarrantable jurisdiction but were met with indifference.</p>
                                    <p>Consequently, the Representatives of the united States of America declared that these united Colonies are, and of Right ought to be Free and Independent States. They are Absolved from all Allegiance to the British Crown, and all political connection between them and Great Britain is totally dissolved. As Free and Independent States, they have full Power to levy War, conclude Peace, contract Alliances, establish Commerce, and perform all other acts and things that independent States may rightfully do. For the support of this Declaration, they mutually pledged their Lives, Fortunes, and sacred Honor.</p>
                                    <p>Among the signers of the Declaration of Independence was Thomas Jefferson from Virginia. While the source lists him as a signer, it does not explicitly state that he was the primary author, nor does it refer to him as the third US President.</p>
                                    <h3 class="mt-6">Audio Summary</h3>
                                    <audio controls class="w-full">
                                        <source src="https://docs.google.com/uc?id=1coxySvms3OgB90zrEbQIH3mSr_kM8oL1" type="audio/mpeg">
                                        Your browser does not support the audio element.
                                    </audio>
                                </div>
                            `
                        },
                        'wwi': {
                            title: 'World War I (1914-1918)',
                            content: `
                               <div class="prose prose-custom" id="topic-text-wwi">
                                    <h2>World War I</h2>
                                    <p>World War I, initially known as the Great War and the War to End All Wars, lasted from 1914 to 1918. It was the largest war seen up to that time, with most battles occurring in Europe and the Middle East. The conflict resulted in over 8 million soldier and sailor deaths and more than 20 million injuries. Despite hopes that such a devastating war would prevent future conflicts, its outcomes contributed to the outbreak of World War II in 1939.</p>
                                    <h3>Causes of the War:</h3>
                                    <p>The war began with a murder in Sarajevo on June 28, 1914. Archduke Francis Ferdinand, nephew of the Austro-Hungarian emperor, was shot and killed by a Bosnian Serb. Austria-Hungary, whose region of Bosnia had long been unfriendly with neighboring Serbia due to Serbian desires for unification, accused Serbia of planning the crime. On July 28, Austria-Hungary declared war on Serbia. This declaration triggered a system of alliances, drawing more countries into the conflict.</p>
                                    <h3>Combatants and Alliances:</h3>
                                    <p>Initially, two major alliance systems formed:</p>
                                    <ul>
                                        <li><strong>Triple Alliance (Central Powers):</strong> Austria-Hungary, Germany, and later Bulgaria and the Ottoman Empire. Italy was initially part of the Triple Alliance but did not go to war at first and later joined the Allies in 1915.</li>
                                        <li><strong>Triple Entente (Allies):</strong> Russia (who protected Serbia), France, and the United Kingdom (Great Britain). The United States also joined the Allies in 1917.</li>
                                    </ul>
                                    <h3>Major Battlefronts and Warfare:</h3>
                                    <p>Most of the war's battles took place in Europe and the Middle East.</p>
                                    <p><strong>The Western Front:</strong> Battlefields west of Germany, stretching from the Belgian coast to the Swiss border, became synonymous with four years of trench warfare. Soldiers dug long trenches for protection, separated by a "no-man's land" covered with barbed wire. Rapid-firing machine guns were used against those attempting to cross this area.</p>
                                    <ul>
                                        <li>Key battles included the First Battle of the Marne (September 6-12, 1914), where Allies pushed back the Germans.</li>
                                        <li>In 1916, two of the war's worst battles occurred: the Battle of Verdun (February 21-July 1916) and the First Battle of the Somme (July 1-November 13, 1916). The First Battle of the Somme alone resulted in over 600,000 casualties on each side for only about 5 miles of gained ground.</li>
                                        <li>New weapons were introduced to break trench defenses. At the Second Battle of Ypres (April 22-May 25, 1915), Germans used chlorine poison gas, leading both sides to employ chemical weapons and gas masks. The British invented tanks, armored vehicles with crawler tracks, first used in 1916 at the First Battle of the Somme, to navigate trenches and barbed wire.</li>
                                    </ul>
                                    <p><strong>The Eastern Front:</strong> Battlefields east of Germany saw faster army movements.</p>
                                    <ul>
                                        <li>In 1914, Russian armies advanced into Germany and Austria-Hungary, but the Germans responded with a crushing blow at the Battle of Tannenberg (August 26-30, 1914).</li>
                                        <li>Bulgaria joined the Central Powers, and their combined forces took Serbia. Allied forces at Salonika in Greece made little progress until the war's end.</li>
                                    </ul>
                                    <p><strong>The Middle East:</strong> The Ottoman Empire (present-day Turkey) joined the Central Powers at the end of 1914, attacking Russia.</p>
                                    <ul>
                                        <li>Allied troops, including those from Britain, Australia, and New Zealand, failed to stop the Ottomans on Turkey's Gallipoli Peninsula in the Dardanelles Campaign (February 1915-January 1916).</li>
                                        <li>British-led troops eventually succeeded in taking Baghdad in March 1917, and later other Ottoman lands. A British officer, T.E. Lawrence (Lawrence of Arabia), led Arabs in battles against the Ottomans.</li>
                                    </ul>
                                    <h3>War at Sea:</h3>
                                    <p>The British Navy, with more and better warships, implemented a naval blockade to stop ships from reaching German ports. However, German submarines (U-boats) posed a significant threat.</p>
                                    <ul>
                                        <li>In 1915, Germany announced it would sink enemy ships in British waters, notably sinking the British passenger ship Lusitania on May 7, 1915, killing nearly 1,200 people, including many U.S. citizens.</li>
                                        <li>German submarines caused the loss of about 6,000 Allied ships, with the United Kingdom alone losing 13,000 lives. Allies defended supply ships by arming them and having them sail in convoys protected by warships.</li>
                                    </ul>
                                    <h3>War in the Air:</h3>
                                    <p>Airplanes, invented only 11 years before the war, were utilized.</p>
                                    <ul>
                                        <li>Germany initially used zeppelins (floating aircraft) to bomb the United Kingdom, which then built antiaircraft guns.</li>
                                        <li>Both sides developed warplanes, including fighters with machine guns. By 1917, Germans dropped bombs from large planes on London and other cities, causing civilian casualties.</li>
                                    </ul>
                                    <h3>Events of 1917 and Turning the Tide:</h3>
                                    <ul>
                                        <li>The Russian Revolution in 1917 significantly altered the Eastern Front. The Bolsheviks took over Russia in November and made peace with the Central Powers almost immediately, allowing Germany to move troops elsewhere.</li>
                                        <li>The United States, initially neutral, declared war on Germany on April 6, 1917. This decision was prompted by Germany's continued attacks on U.S. supply ships and the discovery of Germany's promise to give Texas, New Mexico, and Arizona to Mexico in exchange for Mexico's help in the war.</li>
                                        <li>The arrival of nearly 10,000 U.S. troops per day in France by 1918 shifted the balance on the Western Front, where Germans had initially outnumbered Allied soldiers. German attacks, such as the Second Battle of the Somme, achieved some success but ultimately exhausted their troops.</li>
                                        <li>After the Second Battle of the Marne in July 1918, the Allies gained control of the war and by November, had driven the Germans back to the 1914 battle lines.</li>
                                    </ul>
                                    <h3>End of the War:</h3>
                                    <p>The Central Powers began to surrender:</p>
                                    <ul>
                                        <li>Bulgaria surrendered on September 29, 1918.</li>
                                        <li>Austria and the Ottomans requested a cease-fire on October 30, 1918.</li>
                                        <li>Facing starvation due to the naval blockade, German government leaders signed an armistice (agreement to end fighting) on November 11, 1918.</li>
                                    </ul>
                                    <h3>The Peace and Its Aftermath:</h3>
                                    <ul>
                                        <li>In January 1919, Allied leaders met in Paris to create a peace treaty. The Treaty of Versailles was signed with Germany on June 28, 1919.</li>
                                        <li>The treaty imposed harsh terms on Germany: it could only keep a small army and navy and was forced to pay a large amount of money to the Allies.</li>
                                        <li>The treaty also established the League of Nations, an organization intended to prevent future wars.</li>
                                        <li>However, the U.S. Senate refused to ratify the Treaty of Versailles, partly due to opposition to the League of Nations.</li>
                                        <li>The peace did not last. The German people resented the harsh punishments, leading to the rise of Adolf Hitler in 1933. Hitler rebuilt the German military, and the League of Nations failed to stop him, ultimately contributing to World War II.</li>
                                    </ul>
                                    <h3 class="mt-6">Audio Summary</h3>
                                    <audio controls class="w-full">
                                        <source src="https://docs.google.com/uc?id=14T1grXIfhEwxNl99UMEio4IaP1NnKE_F" type="audio/mpeg">
                                        Your browser does not support the audio element.
                                    </audio>
                               </div>
                            `
                        },
                         'wwii': {
                            title: 'World War II (1939-1945)',
                            content: `
                               <div class="prose prose-custom" id="topic-text-wwii">
                                    <h2>World War II: European Theater - Key Concepts and Facts</h2>
                                    <h3>I. Introduction & Buildup to War</h3>
                                    <p><strong>Global Conflict (1939-1945):</strong> Primarily between the Axis Powers (Germany, Italy, Japan) and the Allies (France, Great Britain, United States, Soviet Union, China).</p>
                                    <p><strong>Enormous Human Cost:</strong> Estimates range from 35 million to 60 million deaths, with millions more wounded or left homeless. Civilian deaths alone were at least 20 million, from bombings, starvation, epidemics, and genocide.</p>
                                    <h4>Causes - Axis Aggression (1931-1939):</h4>
                                    <ul>
                                        <li>Germany, Italy, and Japan engaged in warlike acts and took territories.</li>
                                        <li>The League of Nations proved ineffective in stopping Italian aggression (e.g., invasion of Ethiopia) and German expansion (e.g., takeover of Austria).</li>
                                        <li><strong>Appeasement Policy:</strong> Britain and France initially allowed German dictator Adolf Hitler and Italian dictator Benito Mussolini to take desired territories, hoping to prevent war.</li>
                                        <li><strong>Munich Agreement (September 1938):</strong> Britain and France agreed to let Germany have the Sudetenland (part of Czechoslovakia). Hitler broke this promise by taking the rest of Czechoslovakia in March 1939, effectively ending appeasement.</li>
                                    </ul>
                                    <h4>Key Pacts before War:</h4>
                                    <ul>
                                        <li><strong>German-Italian Pact (May 1939):</strong> Pledged mutual support in war.</li>
                                        <li><strong>Nazi-Soviet Nonaggression Pact (August 1939):</strong> Signed by Hitler and Soviet dictator Joseph Stalin to prevent Germany from fighting on two fronts.</li>
                                    </ul>
                                    <h3>II. The War Begins in Europe (1939-1941)</h3>
                                    <p><strong>Invasion of Poland (September 1, 1939):</strong> Germany invaded Poland using "blitzkrieg" ("lightning war") tactics, destroying airfields, crippling communications, and encircling Polish armies with armored divisions. Britain and France declared war on Germany two days later.</p>
                                    <p><strong>Soviet Actions in Eastern Europe:</strong> The Soviet Union invaded eastern Poland on September 17, and later fought Finland in the Soviet-Finnish War (November 1939- March 1940), gaining Finnish territory.</p>
                                    <p><strong>"Phony War" (Sitzkrieg) on the Western Front:</strong> Little direct fighting on land as French forces (Maginot Line) and German forces (Siegfried Line) faced each other. However, the war at sea was active, with German U-boats sinking many Allied merchant and passenger ships.</p>
                                    <h4>German Expansion (1940):</h4>
                                    <ul>
                                        <li>Germany conquered Denmark and Norway (April-June 1940).</li>
                                        <li>Invaded Belgium, the Netherlands, and Luxembourg (May 1940).</li>
                                        <li><strong>Dunkirk Evacuation (May 29 - June 4, 1940):</strong> 360,000 Allied soldiers were evacuated from Dunkirk, leaving their equipment behind.</li>
                                        <li><strong>Fall of France (June 1940):</strong> German forces advanced rapidly, taking Paris. More than half of France was occupied, and a collaborationist Vichy government was established. Free French forces under Charles de Gaulle continued fighting from Britain.</li>
                                    </ul>
                                    <p><strong>Battle of Britain (August-October 1940):</strong> Germany's air assault (the Blitz) on England aimed to soften it for invasion. The Royal Air Force (RAF), aided by radar, successfully defended against German bombers, preventing a German invasion of England. This was a crucial turning point, as Hitler never seriously considered invading Britain after October 1940.</p>
                                    <p><strong>Axis Formalized:</strong> Japan signed the Tripartite (Axis) Pact with Germany and Italy in September 1940, formalizing the Rome-Berlin-Tokyo Axis.</p>
                                    <h4>US Support for Allies (pre-entry):</h4>
                                    <ul>
                                        <li><strong>The Lend-Lease Act (early 1941)</strong> authorized lending or leasing war materials to Allied nations, making the US the "Arsenal of Democracy".</li>
                                        <li><strong>Atlantic Charter (August 1941):</strong> US President Roosevelt and British Prime Minister Churchill met to outline Allied war aims, calling for the "final destruction of Nazi tyranny".</li>
                                    </ul>
                                    <p><strong>Germany Invades Soviet Union (June 22, 1941):</strong> Germany broke the nonaggression pact, opening a massive Eastern Front extending 2,000 miles. The Soviets employed a "scorched earth" policy and strong resistance, halting the German advance by late 1941.</p>
                                    <h3>III. Turning Points and Allied Offensives in Europe (1942-1944)</h3>
                                    <h4>North Africa:</h4>
                                    <ul>
                                        <li><strong>Battle of El Alamein (October 1942):</strong> British forces under General Montgomery drove Axis forces from Egypt, a turning point in North Africa.</li>
                                        <li><strong>Operation Torch (November 1942):</strong> American and British forces under General Dwight D. Eisenhower landed in French North Africa, leading to the Axis surrender in Tunisia by May 1943.</li>
                                    </ul>
                                    <p><strong>Eastern Front - Battle of Stalingrad (August 1942 - February 1943):</strong> Fierce street-by-street resistance by the Red Army halted the German advance. The Soviets encircled and defeated the German 6th Army, marking a critical turning point in Europe.</p>
                                    <p><strong>Invasion of Italy (July 1943):</strong> Allies invaded Sicily, leading to Benito Mussolini's removal, but German forces fought fiercely up the Italian mainland. Rome was captured by Allies in June 1944.</p>
                                    <p><strong>Battle of the Atlantic (1943):</strong> Allies developed new defenses against German U-boats, including long-range bombers and advances in radar and sonar. British intelligence (Ultra) from the broken "Enigma" code was also crucial in defeating the U-boat menace.</p>
                                    <p><strong>Strategic Bombing of Germany (1943-1944):</strong> American (daylight) and British (night) bombing raids intensified, targeting German industry and infrastructure, such as oil centers (e.g., Ploesti, Romania). The P-51 Mustang fighter provided crucial long-range escort.</p>
                                    <h4>D-Day (Normandy) Invasion (June 6, 1944):</h4>
                                    <ul>
                                        <li>"Operation Overlord" saw a massive fleet land American, British, and Canadian divisions on Normandy beaches, opening the Western Front.</li>
                                        <li>Allies broke out of beachheads by July 25.</li>
                                        <li>Paris was liberated on August 25.</li>
                                    </ul>
                                    <p><strong>Battle of the Bulge (December 1944):</strong> A surprise German counteroffensive in the Ardennes forest. Despite initial German success, Allied resistance halted the advance, leading to a major German defeat and heavy losses.</p>
                                    <h3>IV. The End of the War in Europe (1945)</h3>
                                    <p><strong>Germany's Collapse:</strong> Allied armies advanced into Germany from both west and east.</p>
                                    <p><strong>Fall of Berlin (April 1945):</strong> The Red Army attacked Berlin. Hitler committed suicide on April 30.</p>
                                    <p><strong>German Surrender (May 7-8, 1945):</strong> Germany surrendered unconditionally to the Allies.</p>
                                    <h3>V. Consequences and Post-War Europe</h3>
                                    <p><strong>Shift in Global Power:</strong> Decisive shift of power away from Western Europe towards the United States and the Soviet Union.</p>
                                    <p><strong>The Cold War:</strong> The tense rivalry between the US and Soviet Union emerged, influencing global events for the next 50 years.</p>
                                    <h4>Division of Germany:</h4>
                                    <ul>
                                        <li>Germany was divided into American, British, French, and Soviet occupation zones, with Berlin also divided.</li>
                                        <li>The Soviet blockade of Berlin (June 1948) attempted to force Western powers out.</li>
                                        <li>The Berlin Airlift (1948-1949) successfully supplied West Berlin by air for 11 months, leading to the lifting of the blockade.</li>
                                        <li>This led to the formation of West Germany (Federal Republic of Germany) and East Germany (German Democratic Republic).</li>
                                    </ul>
                                    <h4>New International Organizations:</h4>
                                    <ul>
                                        <li><strong>United Nations (UN):</strong> Established (October 24, 1945) to assure peace and avoid past mistakes.</li>
                                        <li><strong>United Nations Relief and Rehabilitation Administration (UNRRA):</strong> Set up in 1943 for postwar relief and rehabilitation.</li>
                                        <li><strong>Marshall Plan (1947):</strong> The US provided over $13 billion to rebuild Western Europe to create a strong economy and counter Communist aggression. The plan was a great success.</li>
                                    </ul>
                                    <p><strong>War Crimes Trials:</strong> Held at Nuremberg, Germany, for leading Nazis, with many executed or imprisoned.</p>
                                    <p><strong>Peace Treaties (1947):</strong> Treaties were drafted with Italy, Hungary, Bulgaria, Romania, and Finland, addressing territorial changes, reparations, and disarmament. Guarantees were given against racial discrimination and the rebirth of fascist governments.</p>
                                    <p><strong>Austria and Trieste:</strong> Austria was also divided into four occupation zones and later reunited in 1955. Trieste became a trouble spot, eventually divided between Italy and Yugoslavia.</p>
                                    <p><strong>Decline of British Power:</strong> Britain began to give up its empire, granting independence to India (1947) and turning over the Palestine problem to the UN.</p>
                                    <h3 class="mt-6">Audio Summary</h3>
                                    <audio controls class="w-full">
                                        <source src="https://docs.google.com/uc?id=11H_W9Pn6THl02gFC3D1Ciq7XPR7LsvDZ" type="audio/mpeg">
                                        Your browser does not support the audio element.
                                    </audio>
                               </div>
                            `
                        },
                        'holocaust': {
                            title: 'The Holocaust',
                            content: `
                                <div class="prose prose-custom" id="topic-text-holocaust">
                                    <h2>The Holocaust</h2>
                                    <p>Here is a brief and informative summary, focusing on key events and information from the provided sources, relevant for a quiz:</p>
                                    <p>The Holocaust Explained is a website designed for schools to help learners understand the essential facts of the Holocaust, its causes, and consequences.</p>
                                    <ul>
                                        <li>It is managed by The Wiener Holocaust Library, which is Britain's national Holocaust archive and the oldest archive of material on the Nazi era and the Holocaust in the world.</li>
                                        <li>The website's main learning materials are accessible to learners aged thirteen to eighteen, with advanced content available for deeper exploration. This advanced content can be activated by clicking a red button on the left side of each page or tapping the topic menu on mobile.</li>
                                        <li>The site includes a timeline of important events in Holocaust history to aid understanding and navigation through the sequence of events.</li>
                                    </ul>
                                    <h3>Key events mentioned in the timeline include:</h3>
                                    <ul>
                                        <li><strong>June 22, 1933:</strong> The Nazis banned the Social Democratic Party of Germany.</li>
                                        <li><strong>June 30, 1934:</strong> The Night of Long Knives, a purge of the Nazi leadership by Hitler, occurred.</li>
                                        <li><strong>June 28, 1935:</strong> Paragraph 175 of the German Criminal Code was revised, intensifying the persecution of gay men.</li>
                                        <li><strong>June 22, 1941:</strong> The Nazis invaded the Soviet Union.</li>
                                        <li><strong>June 9, 1942:</strong> The Nazis liquidated the Czech village of Lidice in response to the assassination of Reinhard Heydrich.</li>
                                        <li><strong>June 6, 1944:</strong> D-Day took place, with British, Canadian, French, and US troops landing on the beaches of German-occupied France.</li>
                                    </ul>
                                    <p>The website also features survivor testimonies, with several individuals like Alice Redlich, Peter Briess, Freddie Knoller, Eva Clarke, and Simon Winston highlighted as examples.</p>
                                    <h3 class="mt-6">Audio Summary</h3>
                                    <audio controls class="w-full">
                                        <source src="https://docs.google.com/uc?id=1Hw8DuAWLuzTLAxjz8OOIhc8O1muLVKsR" type="audio/mpeg">
                                        Your browser does not support the audio element.
                                    </audio>
                                </div>
                            `
                        }
                    },
                    quizQuestions: {
                        'magna-carta': [
                            { q: "The Magna Carta was signed in what year?", a: ["1215", "1066", "1492", "1776"], c: 0 },
                            { q: "Who was the King of England who signed the Magna Carta?", a: ["King John", "King Henry III", "King Richard the Lionheart", "King Edward I"], c: 0 },
                            { q: "What does 'Magna Carta' mean in Latin?", a: ["Great Charter", "My Law", "King's Word", "Fair Trial"], c: 0 },
                            { q: "The Magna Carta established the principle that...", a: ["The King was above the law", "Everyone, including the king, was subject to the law", "Only barons had rights", "The Pope had ultimate authority"], c: 1 },
                            { q: "What famous right is guaranteed in Clause 39 of the Magna Carta?", a: ["Freedom of speech", "The right to vote", "The right to a fair trial by one's equals", "The right to own property"], c: 2 },
                            { q: "The Magna Carta was signed at a meadow called...", a: ["Hastings", "Yorktown", "Waterloo", "Runnymede"], c: 3 },
                            { q: "Which group pressured King John into signing the Magna Carta?", a: ["The peasants", "The French", "The barons", "The clergy"], c: 2 },
                            { q: "The Magna Carta directly influenced which American document?", a: ["The Emancipation Proclamation", "The Monroe Doctrine", "The U.S. Constitution and Bill of Rights", "The Articles of Confederation"], c: 2 },
                            { q: "Initially, the Magna Carta was a failure and was nullified by...", a: ["The King of France", "The Pope", "The English Parliament", "The barons themselves"], c: 1 },
                            { q: "How many clauses were in the original Magna Carta?", a: ["10", "42", "63", "95"], c: 2 },
                        ],
                        'french-revolution': [
                            { q: "The Directory ruled France from...", a: ["1789-1792", "1793-1794", "1795-1799", "1804-1815"], c: 2 },
                            { q: "The period immediately before The Directory was known as...", a: ["The Enlightenment", "The Reign of Terror", "The Napoleonic Era", "The Restoration"], c: 1 },
                            { q: "Who held political power under The Directory's constitution?", a: ["All adult men", "Only the nobility", "The Jacobins", "Wealthier, property-owning middle class"], c: 3 },
                            { q: "The executive branch of The Directory was composed of...", a: ["A single president", "A king", "Three consuls", "Five men"], c: 3 },
                            { q: "Which of these was a major problem faced by The Directory?", a: ["Peace and prosperity", "Strong public support", "Famine, war, and corruption", "An alliance with Britain"], c: 2 },
                            { q: "The Directory was overthrown in 1799 by...", a: ["Maximilien Robespierre", "King Louis XVI", "Napoleon Bonaparte", "The people of Paris"], c: 2 },
                            { q: "What was the government structure before The Directory?", a: ["An absolute monarchy", "A constitutional monarchy", "The Jacobin government", "A military junta"], c: 2 },
                            { q: "The Directory's constitution denied voting rights to...", a: ["Women", "Nobility", "Non-propertied sections of society", "Clergy"], c: 2 },
                            { q: "As The Directory weakened, which group in France gained more power?", a: ["The Church", "The Monarchy", "The Military", "The Merchant class"], c: 2 },
                            { q: "Napoleon Bonaparte overthrew The Directory in an event called a...", a: ["Referendum", "Revolution", "Coup d'état", "Abdication"], c: 2 }
                        ],
                        'declaration-of-independence': [
                            { q: "The Declaration of Independence was adopted on what date?", a: ["April 19, 1775", "July 4, 1776", "October 17, 1781", "September 3, 1783"], c: 1 },
                            { q: "Who was the primary author of the Declaration of Independence?", a: ["George Washington", "Benjamin Franklin", "John Adams", "Thomas Jefferson"], c: 3 },
                            { q: "The Declaration lists 'Life, Liberty and the pursuit of Happiness' as...", a: ["Negotiable rights", "Unalienable Rights", "Rights for landowners only", "Suggestions for government"], c: 1 },
                            { q: "According to the Declaration, governments derive their power from...", a: ["The king", "Military strength", "The consent of the governed", "Divine right"], c: 2 },
                            { q: "The bulk of the Declaration of Independence is a list of grievances against...", a: ["The French", "King George III", "The Spanish", "The Parliament"], c: 1 },
                            { q: "Which of these was NOT a grievance listed in the Declaration?", a: ["Taxation without representation", "Forcing colonists to practice a certain religion", "Keeping standing armies in peacetime", "Cutting off trade"], c: 1 },
                            { q: "The Declaration states that it is the right of the people to do what to a tyrannical government?", a: ["Write letters of complaint", "Move to another country", "Alter or abolish it", "Pay its taxes"], c: 2 },
                            { q: "The Declaration officially declared the thirteen colonies to be...", a: ["A new kingdom", "Free and Independent States", "Part of the French Empire", "Under the protection of Spain"], c: 1 },
                            { q: "The ideas in the Declaration were heavily influenced by the intellectual movement known as...", a: ["The Renaissance", "The Reformation", "The Enlightenment", "The Romantic Era"], c: 2 },
                            { q: "What did the signers of the Declaration pledge to each other?", a: ["Their land and gold", "Their allegiance to a new king", "Their Lives, Fortunes, and sacred Honor", "A peaceful negotiation with Britain"], c: 2 }
                        ],
                        'wwi': [
                            { q: "World War I took place between which years?", a: ["1905-1910", "1914-1918", "1929-1935", "1939-1945"], c: 1 },
                            { q: "The assassination of which figure triggered the start of WWI?", a: ["Kaiser Wilhelm II", "Tsar Nicholas II", "Archduke Franz Ferdinand", "King George V"], c: 2 },
                            { q: "Which of these countries was one of the Central Powers?", a: ["France", "Great Britain", "Russia", "Germany"], c: 3 },
                            { q: "The fighting on the Western Front was characterized by...", a: ["Naval battles", "Guerilla warfare", "Trench warfare", "Fast-moving tank battles"], c: 2 },
                            { q: "What new weapon was first used by the Germans at the Second Battle of Ypres?", a: ["Tanks", "Airplanes", "Poison gas", "Submarines"], c: 2 },
                            { q: "The sinking of which passenger ship in 1915 angered the United States?", a: ["The Titanic", "The Lusitania", "The Britannia", "The Andrea Doria"], c: 1 },
                            { q: "What event caused Russia to withdraw from WWI in 1917?", a: ["A major military defeat", "The Russian Revolution", "A treaty with Britain", "A famine"], c: 1 },
                            { q: "Which country's entry into the war in 1917 was a major turning point for the Allies?", a: ["Italy", "Japan", "China", "The United States"], c: 3 },
                            { q: "The armistice ending the fighting in WWI was signed on...", a: ["July 4, 1917", "December 25, 1917", "November 11, 1918", "June 28, 1919"], c: 2 },
                            { q: "What was the name of the treaty that officially ended WWI and imposed harsh terms on Germany?", a: ["The Treaty of Paris", "The Geneva Convention", "The Yalta Agreement", "The Treaty of Versailles"], c: 3 }
                        ],
                        'wwii': [
                            { q: "WWII began on September 1, 1939, with the German invasion of...", a: ["France", "The Soviet Union", "Poland", "Great Britain"], c: 2 },
                            { q: "Which of these countries was NOT an Axis power?", a: ["Germany", "Italy", "The Soviet Union", "Japan"], c: 2 },
                            { q: "The policy of Britain and France giving in to Hitler's demands before the war was called...", a: ["Appeasement", "Containment", "Isolationism", "Détente"], c: 0 },
                            { q: "The 'blitzkrieg' tactic used by Germany means...", a: ["Trench warfare", "Naval blockade", "Lightning war", "Carpet bombing"], c: 2 },
                            { q: "The Battle of Britain was fought primarily...", a: ["At sea", "In the air", "With tanks", "On the beaches"], c: 1 },
                            { q: "What was the code name for the Allied invasion of Normandy on D-Day?", a: ["Operation Torch", "Operation Barbarossa", "Operation Overlord", "Operation Market Garden"], c: 2 },
                            { q: "The turning point battle on the Eastern Front between Germany and the USSR was...", a: ["The Battle of Moscow", "The Battle of Stalingrad", "The Battle of Kursk", "The Battle of Berlin"], c: 1 },
                            { q: "D-Day, the Allied invasion of Normandy, occurred on what date?", a: ["December 7, 1941", "June 6, 1944", "May 8, 1945", "August 6, 1945"], c: 1 },
                            { q: "What was Germany's final major offensive on the Western Front?", a: ["The Battle of France", "The Battle of Britain", "The Battle of the Bulge", "The Battle of Berlin"], c: 2 },
                            { q: "V-E Day (Victory in Europe Day) is celebrated on which date?", a: ["April 30", "May 8", "June 6", "September 2"], c: 1 }
                        ],
                        'holocaust': [
                            { q: "The Holocaust was the systematic murder of how many Jews by the Nazi regime?", a: ["About 1 million", "About 3 million", "About 6 million", "About 10 million"], c: 2 },
                            { q: "What was the name of the laws passed in 1935 that stripped Jews of their citizenship?", a: ["The Enabling Act", "The Nuremberg Laws", "The Final Solution", "The Warsaw Decree"], c: 1 },
                            { q: "The event in November 1938, where Jewish synagogues and businesses were destroyed, is known as...", a: ["D-Day", "The Night of the Long Knives", "Kristallnacht (Night of Broken Glass)", "The Beer Hall Putsch"], c: 2 },
                            { q: "The Nazi plan for the genocide of the Jewish people was called...", a: ["The New Order", "The Master Plan", "The Final Solution", "Lebensraum"], c: 2 },
                            { q: "What was the largest Nazi extermination camp?", a: ["Dachau", "Buchenwald", "Treblinka", "Auschwitz-Birkenau"], c: 3 },
                            { q: "Mobile killing units that carried out mass shootings in Eastern Europe were called...", a: ["Gestapo", "Einsatzgruppen", "Luftwaffe", "Wehrmacht"], c: 1 },
                            { q: "Besides Jews, which other group was a primary target of Nazi persecution?", a: ["Italians", "French", "Roma (Gypsies)", "British"], c: 2 },
                            { q: "Where were the post-war trials held for leading Nazi officials?", a: ["Berlin", "Munich", "Nuremberg", "Paris"], c: 2 },
                            { q: "What were the overcrowded, sealed-off areas of cities where Jews were forced to live called?", a: ["Suburbs", "Districts", "Ghettos", "Camps"], c: 2 },
                            { q: "The Nazis came to power in Germany in what year?", a: ["1923", "1933", "1939", "1945"], c: 1 }
                        ],
                    }
                };
            },
            methods: {
                // ... (existing methods: navigate, startQuiz, submitAnswer, getResultsFeedback, shuffleArray, etc.)

                 // --- New methods for Gemini API ---
                async simplifyText() {
                    if (this.isLoading) return;
                    this.isLoading = true;
                    this.showModal = true;
                    this.modalContent = '✨ Our AI is simplifying the text for you...';
                    this.renderPage();

                    try {
                        const topicText = document.getElementById(`topic-text-${this.currentTopic}`).innerText;
                        const prompt = `Please explain the following historical text in simple, easy-to-understand terms, as if you were explaining it to a 15-year-old. Keep it concise but cover the main points:\n\n---\n${topicText}`;
                        
                        const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = ""; // API key will be automatically provided
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates[0].content.parts[0].text) {
                            this.modalContent = result.candidates[0].content.parts[0].text.replace(/\n/g, '<br>');
                        } else {
                            this.modalContent = 'Sorry, we couldn\'t simplify the text at this time. Please try again.';
                        }
                    } catch (error) {
                        console.error("Error simplifying text:", error);
                        this.modalContent = 'An error occurred. Please check the console for details.';
                    } finally {
                        this.isLoading = false;
                        this.renderPage();
                    }
                },

                async generateNewQuestions() {
                    if (this.isLoading) return;
                    this.isLoading = true;
                    this.renderPage(); // To show loading state on the button

                    try {
                        const topicText = document.getElementById(`topic-text-${this.quizType}`).innerText;
                        const prompt = `Based on the following text about ${this.topics[this.quizType].title}, generate 5 new and unique multiple-choice quiz questions that are different from the existing ones. Ensure the response is only a valid JSON array of objects, where each object has keys 'q' (string), 'a' (array of 4 strings), and 'c' (integer index of the correct answer).`;

                        const payload = {
                            contents: [{ role: "user", parts: [{ text: prompt }] }],
                            generationConfig: {
                                responseMimeType: "application/json",
                                responseSchema: {
                                    type: "ARRAY",
                                    items: {
                                        type: "OBJECT",
                                        properties: {
                                            "q": { "type": "STRING" },
                                            "a": { "type": "ARRAY", "items": { "type": "STRING" } },
                                            "c": { "type": "INTEGER" }
                                        },
                                        required: ["q", "a", "c"]
                                    }
                                }
                            }
                        };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                        
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();
                        
                        if (result.candidates && result.candidates[0].content.parts[0].text) {
                            const newQuestions = JSON.parse(result.candidates[0].content.parts[0].text);
                            this.questions = newQuestions.map(q => ({...q, topic: this.quizType}));
                            this.currentQuestionIndex = 0;
                            this.score = 0;
                            this.userAnswers = [];
                            this.currentPage = 'quiz-active';
                        } else {
                           throw new Error("Could not generate new questions.");
                        }

                    } catch (error) {
                        console.error("Error generating new questions:", error);
                        alert("Sorry, we couldn't generate new questions at this time. Please try again.");
                    } finally {
                         this.isLoading = false;
                         this.renderPage();
                    }
                },
                
                async connectTopics() {
                    if (this.isLoading) return;
                    this.isLoading = true;
                    this.connectionContent = '✨ Our AI is analyzing the connection...';
                    this.renderPage();

                    try {
                        const topic1Text = document.getElementById(`topic-text-${this.connectTopic1}`).innerText;
                        const topic2Text = document.getElementById(`topic-text-${this.connectTopic2}`).innerText;
                        
                        const prompt = `Based on the following two historical texts, please explain the historical connection, influence, or contrast between "${this.topics[this.connectTopic1].title}" and "${this.topics[this.connectTopic2].title}".

                        Text 1: ${this.topics[this.connectTopic1].title}
                        ---
                        ${topic1Text}
                        ---

                        Text 2: ${this.topics[this.connectTopic2].title}
                        ---
                        ${topic2Text}
                        ---
                        `;
                        
                        const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = ""; 
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates[0].content.parts[0].text) {
                            this.connectionContent = result.candidates[0].content.parts[0].text.replace(/\n/g, '<br>');
                        } else {
                            this.connectionContent = 'Sorry, we couldn\'t find a connection at this time. Please try again.';
                        }
                    } catch (error) {
                        console.error("Error connecting topics:", error);
                        this.connectionContent = 'An error occurred. Please check the console for details.';
                    } finally {
                        this.isLoading = false;
                        this.renderPage();
                    }
                },
                
                closeModal() {
                    this.showModal = false;
                    this.modalContent = '';
                    this.renderPage();
                },

                // --- Page Rendering ---
                navigate(page, topic = null) {
                    this.currentPage = page;
                    this.currentTopic = topic;
                    window.scrollTo(0, 0);
                },
                startQuiz(type) {
                    this.quizType = type;
                    this.currentQuestionIndex = 0;
                    this.score = 0;
                    this.userAnswers = [];

                    if (type === 'all') {
                        // Get 20 questions from all topics
                        let allQuestions = [];
                        Object.keys(this.quizQuestions).forEach(topic => {
                            this.quizQuestions[topic].forEach(q => {
                                allQuestions.push({ ...q, topic: topic });
                            });
                        });
                        this.questions = this.shuffleArray(allQuestions).slice(0, 20);
                    } else {
                        // Get 10 questions from the selected topic
                        const topicQuestions = this.quizQuestions[type].map(q => ({...q, topic: type}));
                        this.questions = this.shuffleArray(topicQuestions).slice(0, 10);
                    }
                    this.currentPage = 'quiz-active';
                },
                submitAnswer(choiceIndex) {
                    const currentQuestion = this.questions[this.currentQuestionIndex];
                    const isCorrect = choiceIndex === currentQuestion.c;
                    if (isCorrect) {
                        this.score++;
                    }
                    this.userAnswers.push({
                        question: currentQuestion.q,
                        answer: currentQuestion.a[choiceIndex],
                        correctAnswer: currentQuestion.a[currentQuestion.c],
                        isCorrect: isCorrect,
                        topic: currentQuestion.topic
                    });

                    if (this.currentQuestionIndex < this.questions.length - 1) {
                        this.currentQuestionIndex++;
                    } else {
                        this.currentPage = 'quiz-results';
                    }
                },
                getResultsFeedback() {
                    if (this.quizType !== 'all') return '';

                    const incorrectAnswers = this.userAnswers.filter(a => !a.isCorrect);
                    if (incorrectAnswers.length === 0) {
                        return '<p class="text-green-600 font-semibold">Incredible work! You got a perfect score. You have a strong grasp of all topics.</p>';
                    }

                    const topicErrors = {};
                    incorrectAnswers.forEach(answer => {
                        if (!topicErrors[answer.topic]) {
                            topicErrors[answer.topic] = 0;
                        }
                        topicErrors[answer.topic]++;
                    });

                    const weakAreas = Object.keys(topicErrors).filter(topic => topicErrors[topic] >= 2);

                    if (weakAreas.length > 0) {
                        let feedback = '<p class="font-semibold text-lg mb-2">Feedback & Suggestions:</p><p>Based on your results, you might want to review the following topics where you missed a few questions:</p><ul class="list-disc list-inside mt-2">';
                        weakAreas.forEach(topic => {
                            feedback += `<li class="capitalize">${this.topics[topic].title.replace(/_/g, ' ')}</li>`;
                        });
                        feedback += '</ul><p class="mt-2">Consider reviewing the study guides for these areas and trying the specific quizzes for them!</p>';
                        return feedback;
                    }

                    return '<p>Good job! You have a solid understanding across the board. Review the questions you missed to sharpen your knowledge.</p>';
                },
                 shuffleArray(array) {
                    for (let i = array.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [array[i], array[j]] = [array[j], array[i]];
                    }
                    return array;
                },
                renderPage() {
                    const appEl = document.getElementById('app');
                    let modalHtml = this.showModal ? this.ModalComponent() : '';

                    switch (this.currentPage) {
                        case 'home':
                            appEl.innerHTML = this.HomePage();
                            break;
                        case 'topic':
                            appEl.innerHTML = this.TopicPage() + modalHtml;
                            break;
                        case 'quiz':
                            appEl.innerHTML = this.QuizPage();
                            break;
                        case 'quiz-active':
                            appEl.innerHTML = this.QuizActivePage();
                            break;
                        case 'quiz-results':
                             appEl.innerHTML = this.QuizResultsPage();
                             break;
                        case 'connect':
                            appEl.innerHTML = this.ConnectPage();
                            break;
                        default:
                            appEl.innerHTML = this.HomePage();
                    }
                     this.addEventListeners();
                },
                addEventListeners() {
                    // Standard navigation
                    document.querySelectorAll('[data-navigate]').forEach(el => {
                        el.addEventListener('click', (e) => {
                            const page = e.currentTarget.getAttribute('data-navigate');
                            const topic = e.currentTarget.getAttribute('data-topic');
                            this.navigate(page, topic);
                            this.renderPage();
                        });
                    });
                    // Quiz start
                     document.querySelectorAll('[data-quiz-start]').forEach(el => {
                        el.addEventListener('click', (e) => {
                            const type = e.currentTarget.getAttribute('data-quiz-start');
                            this.startQuiz(type);
                             this.renderPage();
                        });
                    });
                    // Quiz answer
                    document.querySelectorAll('[data-answer]').forEach(el => {
                        el.addEventListener('click', (e) => {
                            const choiceIndex = parseInt(e.currentTarget.getAttribute('data-answer'));
                            this.submitAnswer(choiceIndex);
                             this.renderPage();
                        });
                    });
                    // Gemini features
                    const simplifyBtn = document.getElementById('simplify-btn');
                    if(simplifyBtn) simplifyBtn.addEventListener('click', () => this.simplifyText());

                    const newQuestionsBtn = document.getElementById('new-questions-btn');
                    if(newQuestionsBtn) newQuestionsBtn.addEventListener('click', () => this.generateNewQuestions());
                    
                    const connectBtn = document.getElementById('connect-btn');
                    if(connectBtn) connectBtn.addEventListener('click', () => this.connectTopics());

                    const closeModalBtn = document.getElementById('close-modal-btn');
                    if(closeModalBtn) closeModalBtn.addEventListener('click', () => this.closeModal());
                    
                    const connectTopic1Select = document.getElementById('connect-topic-1');
                    if(connectTopic1Select) connectTopic1Select.addEventListener('change', (e) => this.connectTopic1 = e.target.value);

                    const connectTopic2Select = document.getElementById('connect-topic-2');
                    if(connectTopic2Select) connectTopic2Select.addEventListener('change', (e) => this.connectTopic2 = e.target.value);
                },
                HomePage() {
                    let topicCards = '';
                    for (const key in this.topics) {
                        topicCards += `
                        <div class="bg-white rounded-lg shadow-md p-6 topic-card cursor-pointer" data-navigate="topic" data-topic="${key}">
                            <h3 class="text-xl font-semibold text-gray-800">${this.topics[key].title}</h3>
                        </div>`;
                    }

                    return `
                        <div class="min-h-screen bg-gray-100">
                            <header class="bg-white shadow-md">
                                <div class="container mx-auto px-6 py-4">
                                    <h1 class="text-3xl font-bold text-center text-gray-800">History Study Hub</h1>
                                    <p class="text-center text-gray-600 mt-2">Your one-stop resource for the big exam!</p>
                                </div>
                            </header>
                            <main class="container mx-auto px-6 py-12">
                                <h2 class="text-2xl font-semibold text-center mb-8">Select a Topic to Study</h2>
                                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                                    ${topicCards}
                                    <div class="bg-indigo-600 text-white rounded-lg shadow-lg p-6 topic-card cursor-pointer flex flex-col justify-center items-center" data-navigate="quiz">
                                        <h3 class="text-2xl font-bold">Quiz Zone</h3>
                                        <p>Test Your Knowledge!</p>
                                    </div>
                                     <div class="bg-teal-600 text-white rounded-lg shadow-lg p-6 topic-card cursor-pointer flex flex-col justify-center items-center" data-navigate="connect">
                                        <h3 class="text-2xl font-bold">✨ Connect the Dots</h3>
                                        <p>Find historical links!</p>
                                    </div>
                                </div>
                            </main>
                        </div>
                    `;
                },
                TopicPage() {
                    const topic = this.topics[this.currentTopic];
                    return `
                        <div class="min-h-screen bg-white">
                            <header class="bg-gray-800 text-white shadow-md">
                                <div class="container mx-auto px-6 py-4 flex justify-between items-center flex-wrap gap-4">
                                    <h1 class="text-2xl sm:text-3xl font-bold">${topic.title}</h1>
                                    <div>
                                        <button id="simplify-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded mr-2">
                                            ✨ Simplify with AI
                                        </button>
                                        <button class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded" data-navigate="home">
                                            &larr; Back to Menu
                                        </button>
                                    </div>
                                </div>
                            </header>
                             <main class="container mx-auto px-6 py-12">
                                ${topic.content}
                            </main>
                        </div>
                    `;
                },
                QuizPage() {
                    let quizOptions = '';
                    for (const key in this.topics) {
                         quizOptions += `
                            <button class="bg-white hover:bg-gray-200 text-gray-800 font-bold py-4 px-6 rounded-lg shadow-md quiz-option-btn w-full text-left" data-quiz-start="${key}">
                                ${this.topics[key].title} (10 Questions)
                            </button>
                        `;
                    }

                    return `
                         <div class="min-h-screen flex flex-col items-center justify-center bg-gray-100 p-4">
                            <div class="w-full max-w-2xl text-center">
                                 <h1 class="text-4xl font-bold text-gray-800 mb-2">Quiz Zone</h1>
                                 <p class="text-gray-600 mb-8">Choose your challenge.</p>
                                <div class="space-y-4">
                                    ${quizOptions}
                                    <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg quiz-option-btn w-full" data-quiz-start="all">
                                        Comprehensive Exam (20 Questions)
                                    </button>
                                </div>
                                <button class="mt-8 text-indigo-600 hover:text-indigo-800 font-semibold" data-navigate="home">
                                    &larr; Back to Main Menu
                                </button>
                            </div>
                        </div>
                    `;
                },
                QuizActivePage() {
                     const question = this.questions[this.currentQuestionIndex];
                     let optionsHtml = '';
                     question.a.forEach((option, index) => {
                         optionsHtml += `
                            <button class="w-full bg-white hover:bg-indigo-100 border-2 border-gray-300 hover:border-indigo-400 text-gray-800 font-semibold py-3 px-4 rounded-lg text-left transition" data-answer="${index}">
                                ${option}
                            </button>
                         `;
                     });

                    return `
                        <div class="min-h-screen flex items-center justify-center bg-gray-100 p-4">
                            <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-3xl">
                                <div class="mb-4">
                                    <p class="text-sm text-gray-500">Question ${this.currentQuestionIndex + 1} of ${this.questions.length}</p>
                                    <div class="bg-gray-200 rounded-full h-2.5 mt-2">
                                        <div class="bg-indigo-600 h-2.5 rounded-full" style="width: ${((this.currentQuestionIndex + 1) / this.questions.length) * 100}%"></div>
                                    </div>
                                </div>
                                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">${question.q}</h2>
                                <div class="space-y-4">
                                    ${optionsHtml}
                                </div>
                            </div>
                        </div>
                    `;
                },
                QuizResultsPage() {
                    let resultsHtml = '';
                    this.userAnswers.forEach(answer => {
                        resultsHtml += `
                            <div class="p-4 rounded-lg ${answer.isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'} border">
                                <p class="font-semibold text-gray-800">${answer.question}</p>
                                <p class="text-sm ${answer.isCorrect ? 'text-green-700' : 'text-red-700'}">Your answer: ${answer.answer}</p>
                                ${!answer.isCorrect ? `<p class="text-sm text-green-700">Correct answer: ${answer.correctAnswer}</p>` : ''}
                            </div>
                        `;
                    });

                     const feedbackHtml = this.getResultsFeedback();
                     const newQuestionsButtonHtml = this.quizType !== 'all' ? `
                        <button id="new-questions-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg quiz-option-btn w-full sm:w-auto" ${this.isLoading ? 'disabled' : ''}>
                           ${this.isLoading ? 'Generating...' : '✨ Generate New Questions with AI'}
                        </button>` : '';

                    return `
                        <div class="min-h-screen bg-gray-100 p-4 sm:p-6 md:p-8">
                            <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 sm:p-8">
                                <h1 class="text-4xl font-bold text-center text-gray-800">Quiz Results</h1>
                                <div class="text-center my-6">
                                    <p class="text-lg text-gray-600">You scored</p>
                                    <p class="text-6xl font-bold text-indigo-600">${this.score} / ${this.questions.length}</p>
                                </div>
                                
                                ${this.quizType === 'all' ? `<div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg my-6">${feedbackHtml}</div>` : ''}

                                <h2 class="text-2xl font-semibold mt-8 mb-4">Review Your Answers:</h2>
                                <div class="space-y-4">
                                    ${resultsHtml}
                                </div>
                                <div class="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4 flex-wrap">
                                    <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg quiz-option-btn w-full sm:w-auto" data-quiz-start="${this.quizType}">
                                        Try Again
                                    </button>
                                     <button class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg quiz-option-btn w-full sm:w-auto" data-navigate="quiz">
                                        Choose Another Quiz
                                    </button>
                                    ${newQuestionsButtonHtml}
                                </div>
                            </div>
                        </div>
                    `;
                },
                 ConnectPage() {
                    let optionsHtml = '';
                    for (const key in this.topics) {
                        optionsHtml += `<option value="${key}">${this.topics[key].title}</option>`;
                    }
                    
                    return `
                        <div class="min-h-screen bg-gray-100">
                             <header class="bg-white shadow-md">
                                <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                                    <h1 class="text-3xl font-bold text-gray-800">✨ Connect the Dots</h1>
                                     <button class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded" data-navigate="home">
                                        &larr; Back to Menu
                                    </button>
                                </div>
                            </header>
                            <main class="container mx-auto px-6 py-12">
                                <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-lg">
                                    <p class="text-gray-600 mb-6">Select two historical topics to see how they connect, influence, or contrast with each other.</p>
                                    <div class="flex flex-col sm:flex-row items-center gap-4 mb-6">
                                        <select id="connect-topic-1" class="w-full p-2 border border-gray-300 rounded-md">
                                            ${optionsHtml}
                                        </select>
                                        <span class="font-bold text-gray-600">and</span>
                                        <select id="connect-topic-2" class="w-full p-2 border border-gray-300 rounded-md">
                                             ${optionsHtml}
                                        </select>
                                    </div>
                                    <button id="connect-btn" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg" ${this.isLoading ? 'disabled' : ''}>
                                        ${this.isLoading ? 'Analyzing...' : 'Find Connection'}
                                    </button>
                                    
                                    <div id="connection-result" class="mt-8 prose prose-custom max-w-none">
                                        ${this.connectionContent ? `<h3>Connection Analysis</h3><p>${this.connectionContent}</p>` : ''}
                                    </div>
                                </div>
                            </main>
                        </div>
                    `;
                },
                ModalComponent() {
                    return `
                        <div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 modal items-center justify-center">
                            <div class="bg-white rounded-lg shadow-2xl w-11/12 max-w-2xl max-h-[80vh] overflow-y-auto p-6 z-50">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-2xl font-bold text-gray-800">✨ AI Explanation</h3>
                                    <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800">&times;</button>
                                </div>
                                <div class="prose max-w-none">
                                    <p>${this.modalContent}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }

            },
            mounted() {
                this.renderPage();
                // Set default different values for connect page dropdowns
                const topicKeys = Object.keys(this.topics);
                if (topicKeys.length > 1) {
                    this.connectTopic1 = topicKeys[0];
                    this.connectTopic2 = topicKeys[1];
                }
            }
        };

        (function(config) {
            const app = {};
            Object.assign(app, config.data());
            for (const methodName in config.methods) {
                app[methodName] = config.methods[methodName].bind(app);
            }
            config.mounted.call(app);
        })(appConfig);
    </script>
</body>
</html>
